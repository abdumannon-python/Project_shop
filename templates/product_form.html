{% extends 'base.html' %}
{% block title %}{% if product %}Mahsulotni tahrirlash{% else %}Yangi mahsulot{% endblock %}

{% block content %}
<div class="page-header">
    <div class="container">
        <h2 class="fw-800 mb-1">{% if product %}<i class="bi bi-pencil-square me-2"></i>Mahsulotni tahrirlash{% else %}<i class="bi bi-plus-circle me-2"></i>Yangi mahsulot qo'shish{% endif %}</h2>
        <p class="opacity-75 mb-0">{% if product %}{{ product.title }}{% else %}Mahsulot ma'lumotlarini kiriting{% endif %}</p>
    </div>
</div>

<div class="container pb-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card p-4">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="row g-4">
                        <!-- Title -->
                        <div class="col-md-6">
                            <label class="form-label fw-600">Nomi <span class="text-danger">*</span></label>
                            <input type="text" name="title" class="form-control" placeholder="Mahsulot nomi" value="{{ product.title|default:'' }}" required style="border-radius:10px;">
                        </div>
                        <!-- Brand -->
                        <div class="col-md-6">
                            <label class="form-label fw-600">Brend <span class="text-danger">*</span></label>
                            <input type="text" name="brand" class="form-control" placeholder="Brend nomi" value="{{ product.brand|default:'' }}" required style="border-radius:10px;">
                        </div>
                        <!-- Category -->
                        <div class="col-md-6">
                            <label class="form-label fw-600">Kategoriya <span class="text-danger">*</span></label>
                            <select name="category" class="form-select" required style="border-radius:10px;">
                                <option value="">-- Tanlang --</option>
                                {% for cat in category %}
                                <option value="{{ cat.id }}" {% if product.category.id == cat.id %}selected{% endif %}>{{ cat.title }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <!-- Price -->
                        <div class="col-md-3">
                            <label class="form-label fw-600">Narxi (so'm) <span class="text-danger">*</span></label>
                            <input type="number" name="price" class="form-control" placeholder="0" value="{{ product.price|default:'' }}" required style="border-radius:10px;" min="0" step="0.01">
                        </div>
                        <!-- Percent -->
                        <div class="col-md-3">
                            <label class="form-label fw-600">Chegirma (%)</label>
                            <input type="number" name="percent" class="form-control" placeholder="0" value="{{ product.percent|default:0 }}" min="0" max="100" style="border-radius:10px;">
                        </div>
                        <!-- Stock -->
                        <div class="col-md-6">
                            <label class="form-label fw-600">Omborda soni <span class="text-danger">*</span></label>
                            <input type="number" name="stock" class="form-control" placeholder="0" value="{{ product.stock|default:'' }}" required min="0" style="border-radius:10px;">
                        </div>
                        <!-- Description -->
                        <div class="col-12">
                            <label class="form-label fw-600">Tavsif <span class="text-danger">*</span></label>
                            <textarea name="desc" class="form-control" rows="4" placeholder="Mahsulot haqida batafsil ma'lumot..." required style="border-radius:10px;">{{ product.desc|default:'' }}</textarea>
                        </div>
                        <!-- Main image -->
                        <div class="col-12">
                            <label class="form-label fw-600">Asosiy rasm</label>
                            {% if product.main_image %}
                            <div class="mb-2 d-flex align-items-center gap-3">
                                <img src="{{ product.main_image.url }}" style="width:80px;height:80px;object-fit:cover;border-radius:10px;">
                                <small class="text-muted">Yangi rasm yuklasangiz, o'rnini almashtiradi</small>
                            </div>
                            {% endif %}
                            <input type="file" name="main_image" class="form-control" accept="image/*" style="border-radius:10px;">
                        </div>
                        <!-- Extra images -->
                        <div class="col-12">
                            <label class="form-label fw-600">Qo'shimcha rasmlar</label>
                            {% if product.images.exists %}
                            <div class="d-flex gap-2 flex-wrap mb-2">
                                {% for img in product.images.all %}
                                <img src="{{ img.image.url }}" style="width:70px;height:70px;object-fit:cover;border-radius:10px;border:2px solid #e2e8f0;">
                                {% endfor %}
                            </div>
                            {% endif %}
                            <input type="file" name="images" class="form-control" accept="image/*" multiple style="border-radius:10px;">
                            <small class="text-muted">Bir nechta rasm yuklash mumkin</small>
                        </div>
                    </div>

                    <!-- Price preview -->
                    <div class="card mt-4 p-3" style="background:#f0fdf4;border:1px solid #bbf7d0;">
                        <small class="text-success fw-600"><i class="bi bi-calculator me-1"></i>Chegirmali narx avtomatik hisoblanadi</small>
                    </div>

                    <div class="d-flex gap-3 mt-4">
                        <button type="submit" class="btn btn-primary flex-grow-1 py-3 fw-700">
                            {% if product %}<i class="bi bi-check-circle me-2"></i>Saqlash{% else %}<i class="bi bi-plus-circle me-2"></i>Qo'shish{% endif %}
                        </button>
                        <a href="{% url 'home' %}" class="btn btn-outline-secondary py-3 px-4">Bekor qilish</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
