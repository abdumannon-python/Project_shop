{% extends 'base.html' %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="page-header">
    <div class="container">
        <h2 class="fw-800 mb-1"><i class="bi bi-speedometer2 me-2"></i>Dashboard</h2>
        <p class="opacity-75 mb-0">Xush kelibsiz, {{ request.user.username }}!</p>
    </div>
</div>

<div class="container pb-5">
    <!-- Stats cards -->
    <div class="row g-4 mb-5">
        <div class="col-6 col-md-3">
            <div class="card p-4">
                <div class="d-flex align-items-center gap-3">
                    <div class="rounded-3 d-flex align-items-center justify-content-center flex-shrink-0" style="width:50px;height:50px;background:#ede9fe;">
                        <i class="bi bi-box-seam text-primary-custom fs-4"></i>
                    </div>
                    <div>
                        <div class="fw-800 fs-3 text-primary-custom">{{ total_products|default:"0" }}</div>
                        <small class="text-muted">Mahsulotlar</small>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="card p-4">
                <div class="d-flex align-items-center gap-3">
                    <div class="rounded-3 d-flex align-items-center justify-content-center flex-shrink-0" style="width:50px;height:50px;background:#fef9c3;">
                        <i class="bi bi-bag-check fs-4" style="color:#92400e;"></i>
                    </div>
                    <div>
                        <div class="fw-800 fs-3" style="color:#92400e;">{{ total_orders|default:"0" }}</div>
                        <small class="text-muted">Buyurtmalar</small>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="card p-4">
                <div class="d-flex align-items-center gap-3">
                    <div class="rounded-3 d-flex align-items-center justify-content-center flex-shrink-0" style="width:50px;height:50px;background:#f0fdf4;">
                        <i class="bi bi-people fs-4 text-success"></i>
                    </div>
                    <div>
                        <div class="fw-800 fs-3 text-success">{{ total_users|default:"0" }}</div>
                        <small class="text-muted">Foydalanuvchilar</small>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="card p-4">
                <div class="d-flex align-items-center gap-3">
                    <div class="rounded-3 d-flex align-items-center justify-content-center flex-shrink-0" style="width:50px;height:50px;background:#fef2f2;">
                        <i class="bi bi-wallet2 fs-4 text-danger"></i>
                    </div>
                    <div>
                        <div class="fw-800 fs-3 text-danger">{{ total_revenue|default:"0"|floatformat:0 }}</div>
                        <small class="text-muted">Daromad (so'm)</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick actions -->
    <div class="row g-4 mb-5">
        <div class="col-12">
            <h5 class="section-title mb-3">Tezkor amallar</h5>
            <div class="d-flex flex-wrap gap-3">
                <a href="{% url 'product_create' %}" class="btn btn-primary px-4 py-2 fw-600">
                    <i class="bi bi-plus-circle me-2"></i>Mahsulot qo'shish
                </a>
                <a href="{% url 'order_list' %}" class="btn btn-outline-primary px-4 py-2 fw-600">
                    <i class="bi bi-list-ul me-2"></i>Buyurtmalar
                </a>
                <a href="{% url 'profile' request.user.id %}" class="btn btn-outline-secondary px-4 py-2 fw-600">
                    <i class="bi bi-person me-2"></i>Profil
                </a>
                <a href="/admin/" class="btn btn-outline-dark px-4 py-2 fw-600">
                    <i class="bi bi-gear me-2"></i>Admin panel
                </a>
            </div>
        </div>
    </div>

    <!-- My products table -->
    <div class="row g-4">
        <div class="col-12">
            <div class="card p-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="fw-800 mb-0">Mening mahsulotlarim</h5>
                    <a href="{% url 'product_create' %}" class="btn btn-primary btn-sm"><i class="bi bi-plus me-1"></i>Yangi</a>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead style="background:#f8fafc;">
                            <tr>
                                <th style="border-radius:10px 0 0 10px;padding:12px 16px;">Mahsulot</th>
                                <th>Kategoriya</th>
                                <th>Narxi</th>
                                <th>Chegirma</th>
                                <th>Ombor</th>
                                <th style="border-radius:0 10px 10px 0;">Amallar</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for product in my_products %}
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center gap-3">
                                        {% if product.main_image %}
                                        <img src="{{ product.main_image.url }}" style="width:48px;height:48px;object-fit:cover;border-radius:10px;" alt="">
                                        {% else %}
                                        <div class="bg-secondary rounded-2 d-flex align-items-center justify-content-center" style="width:48px;height:48px;">
                                            <i class="bi bi-image text-white small"></i>
                                        </div>
                                        {% endif %}
                                        <div>
                                            <span class="fw-600">{{ product.title }}</span>
                                            <br><small class="text-muted">{{ product.brand }}</small>
                                        </div>
                                    </div>
                                </td>
                                <td><span class="badge-category">{{ product.category.title }}</span></td>
                                <td class="fw-700 text-primary-custom">{{ product.price|floatformat:0 }} so'm</td>
                                <td>
                                    {% if product.percent %}
                                    <span class="badge-discount">-{{ product.percent }}%</span>
                                    {% else %}
                                    <span class="text-muted">â€”</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <span class="fw-600 {% if product.stock == 0 %}text-danger{% elif product.stock < 5 %}text-warning{% else %}text-success{% endif %}">
                                        {{ product.stock }} ta
                                    </span>
                                </td>
                                <td>
                                    <div class="d-flex gap-2">
                                        <a href="{% url 'product_detail' product.pk %}" class="btn btn-sm btn-outline-primary"><i class="bi bi-eye"></i></a>
                                        <a href="{% url 'product_update' product.pk %}" class="btn btn-sm btn-outline-secondary"><i class="bi bi-pencil"></i></a>
                                        <a href="{% url 'product_delete' product.pk %}" class="btn btn-sm btn-outline-danger" onclick="return confirm('O\'chirishni tasdiqlaysizmi?')"><i class="bi bi-trash"></i></a>
                                    </div>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="text-center text-muted py-4">
                                    <i class="bi bi-box fs-2 mb-2 d-block"></i>
                                    Mahsulot yo'q. <a href="{% url 'product_create' %}">Birinchisini qo'shing!</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
